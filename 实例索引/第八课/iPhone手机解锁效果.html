<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        #iphone {
            position: relative;
            width: 426px;
            height: 640px;
            margin: 10px auto;
            background: url(http://fgm.cc/iphone/1.jpg) no-repeat;
        }

        #lock {
            position: absolute;
            left: 50%;
            bottom: 33px;
            width: 358px;
            height: 62px;
            margin-left: -179px;
        }

        #lock span {
            position: absolute;
            width: 93px;
            height: 62px;
            cursor: pointer;
            background: url(http://fgm.cc/iphone/btn.jpg) no-repeat;
        }
    </style>
</head>

<body>
    <div id="iphone">
        <div id="lock">
            <span></span>
        </div>
    </div>
    <script>
        window.addEventListener('load', function () {
            main()
        })

        var get = document.querySelector.bind(document)
        var log = console.log.bind(console)

        function __main() {
            var slide = get('#lock span')
            var isSliding = false
            var dx = 0
            var maxL = slide.parentNode.offsetWidth - slide.offsetWidth
            var moveTimer = null
            var phone = get('#iphone')

            slide.addEventListener('mousedown', function (e) {
                isSliding = true
                dx = e.clientX - this.offsetLeft
                e.stopPropagation()
            })
            slide.addEventListener('mousemove', function (e) {
                if (!isSliding) {
                    return
                }
                var l = e.clientX - dx
                if (l < 0) {
                    l = 0
                } else if (l > maxL) {
                    l = maxL
                }
                this.style.left = l + 'px'
                e.stopPropagation()
            })
            slide.addEventListener('mouseup', function (e) {
                isSliding = false
                if (this.offsetLeft < maxL / 2) {
                    move(0)
                } else {
                    move(maxL, function () {
                        var img = document.createElement('img')
                        img.src = 'http://fgm.cc/iphone/2.jpg'
                        img.onload = function () {
                            phone.style.background = 'url(' + this.src + ') no-repeat'
                            lock.style.display = 'none'
                        }
                    })
                }
                e.stopPropagation()
            })

            function move(distance, callback) {
                clearTimeout(moveTimer)
                moveTimer = setInterval(function () {
                    var speed = (distance - slide.offsetLeft) / 10
                    if (speed > 0) {
                        speed = Math.ceil(speed)
                    } else {
                        speed = Math.floor(speed)
                    }
                    if (0 === speed) {
                        clearInterval(moveTimer)
                        if (callback) {
                            callback()
                        }
                    } else {
                        slide.style.left = slide.offsetLeft + speed + 'px'
                    }
                }, 1000 / 60)
            }
        }

        function screenLock() {
            var phone = get('#iphone')
            var lock = get('#lock')
            var img = document.createElement('img')
            img.src = 'http://fgm.cc/iphone/2.jpg'
            img.onload = function () {
                phone.style.background = 'url(' + this.src + ') no-repeat'
                lock.style.display = 'none'
            }
        }

        function main() {
            var slide = get('#lock span')
            var isSliding = false
            var dx = 0
            var maxL = slide.parentNode.offsetWidth - slide.offsetWidth
            var moveTimer = null
            var phone = get('#iphone')

            slide.addEventListener('mousedown', function (e) {
                isSliding = true
                dx = e.clientX - this.offsetLeft
                e.stopPropagation()
            })
            slide.addEventListener('mousemove', function (e) {
                if (!isSliding) {
                    return
                }
                var l = e.clientX - dx
                if (l < 0) {
                    l = 0
                } else if (l > maxL) {
                    l = maxL
                }
                this.style.left = l + 'px'
                if (l === maxL) {
                    screenLock()
                }
                e.stopPropagation()
            })
            slide.addEventListener('mouseup', function (e) {
                isSliding = false
                if (this.offsetLeft < maxL / 2) {
                    move(0)
                } else {
                    move(maxL, screenLock)
                }
                e.stopPropagation()
            })

            function move(distance, callback) {
                clearTimeout(moveTimer)
                moveTimer = setInterval(function () {
                    var speed = (distance - slide.offsetLeft) / 10
                    if (speed > 0) {
                        speed = Math.ceil(speed)
                    } else {
                        speed = Math.floor(speed)
                    }
                    if (0 === speed) {
                        clearInterval(moveTimer)
                        if (callback) {
                            callback()
                        }
                    } else {
                        slide.style.left = slide.offsetLeft + speed + 'px'
                    }
                }, 1000 / 60)
            }
        }
    </script>
</body>

</html>