<!DOCTYPE html>
<html lang="zh">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>自定义多级右键菜单</title>
	<style>
		#rightMenu {
			/* display: none; */
			position: absolute;
		}

		#rightMenu ul {
			padding: 0;
			margin: 0;
			padding-left: 20px;
			list-style: none;
			background-color: #F1F1F1;
			border: 1px solid gray;
			box-shadow: 2px 2px 2px gray;
		}

		#rightMenu>ul ul {
			position: absolute;
			/* display: none; */
		}

		#rightMenu li {
			padding: 5px;
			border: 1px solid transparent;
			position: relative;
		}

		#rightMenu li.right-arrow::after {
			content: '';
			display: block;
			position: absolute;
			border: 5px solid transparent;
			border-left: 5px solid black;
			right: 0;
			top: 35%;
		}

		#rightMenu li:hover {
			border-color: skyblue;
			border-radius: 5px;
		}
	</style>
</head>

<body>
	<div id="rightMenu">
		<ul>
			<li>
				<strong>JavaScript学习</strong>
			</li>
			<li>第一课
				<ul>
					<li>网页特效原理分析</li>
					<li>响应用户操作</li>
					<li>提示框效果</li>
					<li>事件驱动</li>
					<li>元素属性操作</li>
				</ul>
			</li>
			<li>第二课
				<ul>
					<li>改变网页背景颜色</li>
					<li>函数传参</li>
					<li>高重用性函数的编写</li>
					<li>126邮箱全选效果</li>
					<li>循环及遍历操作</li>
				</ul>
			</li>
			<li>第三课
				<ul>
					<li>JavaScript组成
						<ul>
							<li>ECMAScript</li>
							<li>DOM</li>
							<li>BOM</li>
							<li>JavaScript兼容性来源</li>
						</ul>
					</li>
					<li>JavaScript出现的位置、优缺点</li>
					<li>变量、类型、typeof、数据类型转换、变量作用域</li>
					<li>闭包
						<ul>
							<li>什么是闭包</li>
							<li>简单应用</li>
							<li>闭包缺点</li>
						</ul>
					</li>
					<li>运算符</li>
					<li>程序流程控制</li>
					<li>定时器的使用
						<ul>
							<li>setInterval</li>
							<li>setTimeout</li>
						</ul>
					</li>
				</ul>
			</li>
		</ul>
	</div>
	<script>
		function get(selector) {
			return document.querySelector(selector)
		}
		function getAll(selector) {
			return document.querySelectorAll(selector)
		}
		function log(msg) {
			console.log(msg)
		}

		function main() {
			customRightMenu()
		}

		function customRightMenu() {
			var m = get('#rightMenu')
			var lis = getAll('#rightMenu li')
			var rightArrow = false
			var showTimer = hideTimer = null
			window.addEventListener('contextmenu', function (e) {
				var x = e.clientX
				var y = e.clientY

				m.style.display = 'block'
				m.style.left = x + 'px'
				m.style.top = y + 'px'

				// right arrow
				if (!rightArrow) {
					lis.forEach(function (li) {
						if (li.querySelector('ul')) {
							li.classList.add('right-arrow')
						}
					})
					rightArrow = true
				}

				// li actions
				lis.forEach(function (li) {
					li.addEventListener('mouseover', function (e) {
						var self = this
						self.classList.add('current')
						var ul = self.firstElementChild
						if (ul) {
							clearTimeout(hideTimer)
							showTimer = setTimeout(function () {
								for (var i = 0; i < self.parentNode.children.length; i++) {
									var ch = self.parentNode.children[i]
									if (ch.querySelector('ul')) {
										ch.querySelector('ul').style.display = 'none'
									}
								}
								ul.style.display = 'block'
								ul.style.left = self.offsetWidth + 'px'
								ul.style.top = 0
								var maxWidth = 0
								for (var i = 0; i < ul.children.length; i++) {
									var l = ul.children[i]
									var lw = l.clientWidth + parseInt(window.getComputedStyle(l)['padding-left'], 10)
									if (lw > maxWidth) {
										maxWidth = lw
									}
								}
								ul.style.width = maxWidth + 'px'
							}, 500)
						}
					})
					li.addEventListener('mouseout', function (e) {
						var self = this
						self.classList.remove('current')
						clearTimeout(showTimer)
						hideTimer = setTimeout(function () {
							for (var i = 0; i < self.parentNode.children.length; i++) {
								var ch = self.parentNode.children[i]
								if (ch.querySelector('ul')) {
									ch.querySelector('ul').style.display = 'none'
								}
							}
						}, 500)
						// e.stopPropagation()
					})
					li.addEventListener('click', function (e) {
						m.style.display = 'none'
					})
				})
				e.preventDefault()
			})
		}

		// main()
	</script>
</body>

</html>