<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>仿腾讯游戏《英雄杀》官网Flash效果</title>
    <style>
        body {
            background-color: rgba(0, 0, 0, 0.3);
        }

        .container {
            width: 750px;
            height: 290px;
            margin: auto;
            position: relative;
        }

        .next,
        .prev {
            position: absolute;
        }

        .prev {
            left: 0;
            bottom: 0;
        }

        .next {
            right: 0;
            bottom: 0;
        }

        .list {
            height: 100%;
            list-style-type: none;
            padding: 0;
            margin: 0;
            font-size: 0;
        }

        .list li {
            display: inline-block;
            position: relative;
            overflow: hidden;
            position: absolute;
        }

        .list li img {
            width: 100%;
            height: 100%;
        }

        .list li div {
            font-size: 12px;
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
            position: absolute;
            bottom: -100px;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            transition: bottom 0.5s;
        }

        .list li:hover div {
            bottom: 0;
        }

        .list li div.display {
            bottom: 0;
        }

        .list li div>* {
            margin: 0;
        }

        .list li span {
            color: red;
        }

        .list li p {
            text-indent: 2em;
        }
    </style>
</head>

<body>
    <div class="container">
        <button class="prev">prev</button>
        <button class="next">next</button>
        <ul class="list">
            <li>
                <img src="http://www.fgm.cc/learn/lesson10/img/yxs/1.jpg" alt="">
                <div>
                    <h4>小乔
                        <span>国色天香</span>
                    </h4>
                    <p>小乔，三国时期的主要女性人物之一。在三国时归属吴国，国色流离、资貌绝伦，是当时有名的东吴美女。</p>
                </div>
            </li>
            <li>
                <img src="http://www.fgm.cc/learn/lesson10/img/yxs/2.jpg" alt="">
                <div>
                    <h4>潘安
                        <span>花样美男</span>
                    </h4>
                    <p>潘安，西晋文学家，本名潘岳。中国古代最著名的美男子之首、"金谷二十四友"之首。</p>
                </div>
            </li>
            <li>
                <img src="http://www.fgm.cc/learn/lesson10/img/yxs/3.jpg" alt="">
                <div>
                    <h4>朱元璋
                        <span>明太祖</span>
                    </h4>
                    <p>朱元璋，明王朝的开国皇帝，建立了全国统一的封建政权。</p>
                </div>
            </li>
            <li>
                <img src="http://www.fgm.cc/learn/lesson10/img/yxs/4.jpg" alt="">
                <div>
                    <h4>吕雉
                        <span>吕后</span>
                    </h4>
                    <p>吕雉，西汉开国皇帝高祖刘邦的原配夫人，中国历史上第一位掌权的女性统治者。</p>
                </div>
            </li>
            <li>
                <img src="http://www.fgm.cc/learn/lesson10/img/yxs/5.jpg" alt="">
                <div>
                    <h4>诸葛亮
                        <span>卧龙</span>
                    </h4>
                    <p>诸葛亮，蜀汉丞相，三国时期杰出的政治家、战略家、发明家、军事家。</p>
                </div>
            </li>
            <li>
                <img src="http://www.fgm.cc/learn/lesson10/img/yxs/6.jpg" alt="">
                <div>
                    <h4>李师师
                        <span>青楼歌妓</span>
                    </h4>
                    <p>李师师，北宋末年色艺双绝的名妓，其事迹多见于野史，笔记小说。据传曾深受宋徽宗喜爱。</p>
                </div>
            </li>
            <li>
                <img src="http://www.fgm.cc/learn/lesson10/img/yxs/7.jpg" alt="">
                <div>
                    <h4>陈圆圆
                        <span>乱世红颜</span>
                    </h4>
                    <p>陈圆圆，名沅，明末清初苏州名姬，浙江金华人氏。"容辞闲雅，额秀頣丰"，有名士大家风度。</p>
                </div>
            </li>
            <li>
                <img src="http://www.fgm.cc/learn/lesson10/img/yxs/8.jpg" alt="">
                <div>
                    <h4>扁鹊
                        <span>神医</span>
                    </h4>
                    <p>扁鹊精于内、外、妇、儿、五官等科，应用针灸、按摩、汤药、热熨等法治疗疾病，被尊为医祖。</p>
                </div>
            </li>
            <li>
                <img src="http://www.fgm.cc/learn/lesson10/img/yxs/9.jpg" alt="">
                <div>
                    <h4>西施
                        <span>西子</span>
                    </h4>
                    <p>西施，名夷光，春秋时间越国人，今浙江诸暨市城关苎萝村。同范蠡同卒于陶（定陶）。</p>
                </div>
            </li>
            <li>
                <img src="http://www.fgm.cc/learn/lesson10/img/yxs/10.jpg" alt="">
                <div>
                    <h4>杨延昭
                        <span>天狼星</span>
                    </h4>
                    <p>杨延昭是北宋抗辽大将杨业的长子，自幼就受到其父抵抗契丹、收复失地的思想影响。</p>
                </div>
            </li>
            <li>
                <img src="http://www.fgm.cc/learn/lesson10/img/yxs/11.jpg" alt="">
                <div>
                    <h4>关羽
                        <span>武圣</span>
                    </h4>
                    <p>关羽，字云长，本字长生，河东解县人（今山西省运城市），东汉末年三国时期刘备的重要将领。</p>
                </div>
            </li>
            <li>
                <img src="http://www.fgm.cc/learn/lesson10/img/yxs/12.jpg" alt="">
                <div>
                    <h4>鲁智深
                        <span>花和尚</span>
                    </h4>
                    <p>鲁智深，梁山泊第十三位好汉，绰号花和尚。因为见郑屠欺侮金翠莲父女，三拳打死了镇关西。</p>
                </div>
            </li>
            <li>
                <img src="http://www.fgm.cc/learn/lesson10/img/yxs/13.jpg" alt="">
                <div>
                    <h4>赢政
                        <span>秦始皇</span>
                    </h4>
                    <p>秦始皇，赢姓，赵氏，名政，秦庄襄王之子。秦始皇22岁时，在雍城举行国君成人加冕仪式。开始"亲理朝政"。</p>
                </div>
            </li>
            <li>
                <img src="http://www.fgm.cc/learn/lesson10/img/yxs/14.jpg" alt="">
                <div>
                    <h4>赵匡胤
                        <span>宋太祖</span>
                    </h4>
                    <p>赵匡胤，中国北宋王朝的建立者，庙号太祖，汉族，涿州（今河北）人。出身军人家庭。高祖赵眺，祖父赵敬。</p>
                </div>
            </li>
        </ul>
    </div>
    <script>
        var log = console.log.bind(console)
        window.addEventListener('load', main)

        function main() {
            var s = new YXS('.list')
            var next = document.querySelector('.next')
            var prev = document.querySelector('.prev')

            next.addEventListener('click', function () {
                s.slideNextMove()
            })
            prev.addEventListener('click', function () {
                s.slidePrevMove()
            })
        }

        // No-animation mode, next version add animations(huge work...)
        // animation added, problem solved
        function YXS(id) {
            this.id = id
            this.setup()
        }
        YXS.prototype.setup = function () {
            this.item = document.querySelector(this.id)
            this.slides = document.querySelectorAll(this.id + '>li')
            this.numberOfMovingSlides = 7 // hard code, const
            this.movingSlides = []
            this.movingModeEnabled = false
            this.movingDuration = 1000 // millseconds
            this.styles = {
                middle: {
                    width: 224,
                    height: 288,
                    top: 0,
                    left: 262,
                    'z-index': 4,
                },
                middleLeft: {
                    width: 170,
                    height: 218,
                    top: 37,
                    left: 110,
                    'z-index': 3,
                },
                leftFar: {
                    width: 130,
                    height: 170,
                    top: 61,
                    left: 0,
                    'z-index': 2,
                },
                leftBehind: {
                    width: 124,
                    height: 154,
                    top: 71,
                    left: 134,
                    'z-index': 1,
                },
                middleRight: {
                    width: 170,
                    height: 218,
                    top: 37,
                    left: 468,
                    'z-index': 3,
                },
                rightFar: {
                    width: 130,
                    height: 170,
                    top: 61,
                    left: 620,
                    'z-index': 2,
                },
                rightBehind: {
                    width: 124,
                    height: 154,
                    top: 71,
                    left: 496,
                    'z-index': 1,
                },
                others: {
                    width: 0,
                    height: 0,
                    top: 37,
                    left: 377,
                    'z-index': 1,
                }
            }

            this.firstGalance()
        }
        YXS.prototype.setStyle = function (obj, options) {
            // little hack for 'z-index' property
            for (var p in options) {
                if (p === 'z-index' || p === 'zIndex') {
                    obj.style[p] = options[p]
                } else {
                    obj.style[p] = options[p] + 'px'
                }
            }
        }
        // update `slides` property to latest value, because of DOM action
        YXS.prototype.updateSlides = function () {
            this.slides = document.querySelectorAll(this.id + '>li')
        }
        // set first five slides' css style
        YXS.prototype.firstGalance = function () {
            this.clearSlideStyle()

            var ss = this.slides
            var leftBehind = ss[0]
            var leftFar = ss[1]
            var middleLeft = ss[2]
            var middle = ss[3]
            var middleRight = ss[4]
            var rightFar = ss[5]
            var rightBehind = ss[6]

            this.setStyle(leftBehind, this.styles.leftBehind)
            this.setStyle(leftFar, this.styles.leftFar)
            this.setStyle(middleLeft, this.styles.middleLeft)
            this.setStyle(middle, this.styles.middle)
            this.setStyle(middleRight, this.styles.middleRight)
            this.setStyle(rightFar, this.styles.rightFar)
            this.setStyle(rightBehind, this.styles.rightBehind)
        }
        // clear every slides' moving timer so that moving is unique(?)
        YXS.prototype.clearMovingSlides = function () {
            this.movingSlides.forEach(function (s) {
                clearInterval(s.timer)
            })
            this.movingSlides = []
        }
        YXS.prototype.slideNextMove = function () {
            this.clearMovingSlides()
            var self = this
            this.movingModeEnabled = true
            var _first = this.slides[0]
            this.item.appendChild(_first)
            this.updateSlides()
            this.clearSlideStyle()

            var ss = this.slides
            var leftFar = AnimationItem(ss[0], this.styles.leftBehind)
            var middleLeft = AnimationItem(ss[1], this.styles.leftFar)
            var middle = AnimationItem(ss[2], this.styles.middleLeft)
            var middleRight = AnimationItem(ss[3], this.styles.middle)
            var rightFar = AnimationItem(ss[4], this.styles.middleRight)
            var rightBehind = AnimationItem(ss[5], this.styles.rightFar)
            var newer = AnimationItem(ss[6], this.styles.rightBehind)

            this.movingSlides.push(leftFar)
            this.movingSlides.push(middleLeft)
            this.movingSlides.push(middle)
            this.movingSlides.push(middleRight)
            this.movingSlides.push(rightFar)
            this.movingSlides.push(rightBehind)
            this.movingSlides.push(newer)
        }
        YXS.prototype.slidePrevMove = function () {
            this.clearMovingSlides()
            var self = this
            this.movingModeEnabled = true
            var _first = this.slides[0]
            var _last = this.slides[this.slides.length - 1]
            this.item.insertBefore(_last, _first)
            this.updateSlides()
            this.clearSlideStyle()

            var ss = this.slides
            var newer = AnimationItem(ss[0], this.styles.leftBehind)
            var leftBehind = AnimationItem(ss[1], this.styles.leftFar)
            var leftFar = AnimationItem(ss[2], this.styles.middleLeft)
            var middleLeft = AnimationItem(ss[3], this.styles.middle)
            var middle = AnimationItem(ss[4], this.styles.middleRight)
            var middleRight = AnimationItem(ss[5], this.styles.rightFar)
            var rightFar = AnimationItem(ss[6], this.styles.rightBehind)

            this.movingSlides.push(newer)
            this.movingSlides.push(leftBehind)
            this.movingSlides.push(leftFar)
            this.movingSlides.push(middleLeft)
            this.movingSlides.push(middle)
            this.movingSlides.push(middleRight)
            this.movingSlides.push(rightFar)

        }
        YXS.prototype.clearSlideStyle = function () {
            // init all slides' css style
            for (var i = 0; i < this.slides.length; i++) {
                if (i < this.numberOfMovingSlides - 1) {
                    this.slides[i].style.display = 'block'
                } else {
                    this.slides[i].style.display = 'none'
                    this.setStyle(this.slides[i], {
                        width: this.styles.others.width,
                        height: this.styles.others.height,
                        left: this.styles.others.left,
                        top: this.styles.others.top,
                        'z-index': 1,
                    })

                }
            }
        }


        function AnimationItem(id, options, callback) {
            var o = {
                id: id,
                options: options,
                timer: null
            }

            o.setup = function () {
                if (typeof this.id === 'string') {
                    this.item = document.querySelector(this.id)
                } else {
                    this.item = this.id
                }

                this.start()
            }
            o.start = function () {
                var self = this
                clearInterval(this.timer)
                this.timer = setInterval(function () {
                    self.move()
                }, 1000 / 60)
            }
            o.css = function (attr, value) {
                if (arguments.length === 1) {
                    var style = window.getComputedStyle(this.item, null)
                    return parseFloat(style[attr])
                } else if (arguments.length === 2) {
                    if (attr === 'opacity') {
                        this.item.style.opacity = value / 100
                    } else if (attr === 'z-index' || attr === 'zIndex') {
                        this.item.style[attr] = value
                    } else {
                        this.item.style[attr] = value + 'px'
                    }
                }
            }
            o.move = function () {
                var complete = false
                for (var p in this.options) {
                    if (p === 'z-index' || p === 'zIndex') {
                        this.item.style['z-index'] = this.options[p]
                        continue
                    }
                    complete = false
                    var value = 0
                    if (p === 'opacity') {
                        value = parseInt(this.css(p).toFixed(2) * 100)
                    } else {
                        value = this.css(p)
                    }
                    var speed = (this.options[p] - value) / 5
                    if (speed > 0) {
                        speed = Math.ceil(speed)
                    } else {
                        speed = Math.floor(speed)
                    }
                    this.css(p, value + speed)
                    if (this.options[p] === value) {
                        complete = true
                    }
                    // log('hi')
                }
                if (complete) {
                    clearInterval(this.timer)
                    log('over')
                    if (callback) {
                        callback()
                    }
                }
            }

            o.setup()
            return o
        }
    </script>
</body>

</html>